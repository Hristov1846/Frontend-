<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YouVibe</title>
  <meta name="description" content="YouVibe ‚Ä¢ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥" />
  <style>
    :root{
      --bg1:#7b2ff7; --bg2:#00d4ff; --text:#0b0b0f;
      --white:#fff; --muted:#a9b0c3; --card:rgba(255,255,255,.12);
      --ok:#22c55e; --warn:#f59e0b; --err:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;color:var(--white);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;
      background: radial-gradient(1100px 700px at 0% 0%, var(--bg1), transparent 60%),
                  radial-gradient(900px 600px at 100% 100%, var(--bg2), transparent 60%),
                  linear-gradient(135deg, #111 0%, #171923 100%);
      background-attachment: fixed;
    }
    .wrap{max-width:980px;margin:0 auto;padding:24px}
    nav{display:flex;align-items:center;gap:12px;margin-bottom:20px}
    .logo{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,var(--bg1),var(--bg2));display:grid;place-items:center}
    .brand{font-size:20px;font-weight:700}
    .links{margin-left:auto;display:flex;gap:6px}
    .links a{color:var(--white);text-decoration:none;padding:8px 12px;border-radius:10px;background:rgba(255,255,255,.06)}
    .grid{display:grid;gap:16px}
    @media(min-width:800px){ .grid{grid-template-columns:1fr 1fr} }

    .card{
      background:var(--card);backdrop-filter: blur(12px);
      border:1px solid rgba(255,255,255,.15);
      border-radius:16px;padding:18px 18px 16px;
      box-shadow: 0 12px 40px rgba(0,0,0,.25);
    }
    h1{font-size:42px;margin:10px 0}
    h3{margin:0 0 10px}
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      font-weight:800;border:0;border-radius:14px;padding:14px 18px;cursor:pointer;
      background:linear-gradient(90deg, var(--bg1), var(--bg2));
      color:#fff; width:100%;
      box-shadow:0 10px 28px rgba(0,0,0,.35);
    }
    .btn[disabled]{opacity:.6;filter:grayscale(.2);cursor:default}
    input,select{
      width:100%; color:#fff; font-size:16px; padding:14px 12px; margin:8px 0;
      background:rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.18); border-radius:12px;
    }
    input::placeholder{color:#e8e8e8aa}
    label.muted{display:flex;align-items:center;gap:8px;color:var(--muted);font-size:14px;margin:8px 0 0}
    .row{display:grid; gap:12px; grid-template-columns:1fr 1fr 1fr}
    .msg{min-height:22px; font-size:14px; margin-top:6px}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)} .muted{color:var(--muted)}

    footer{margin-top:28px;color:var(--muted);font-size:13px;text-align:center}
    .hide{display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <nav>
      <div class="logo">üí´</div>
      <div class="brand">YouVibe</div>
      <div class="links">
        <a href="#/">–ù–∞—á–∞–ª–æ</a>
        <a href="#/auth">–í—Ö–æ–¥</a>
        <a href="#/register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
      </div>
    </nav>

    <div class="grid">
      <!-- LOGIN -->
      <div class="card">
        <h3>–í—Ö–æ–¥</h3>
        <form id="loginForm" class="grid">
          <input id="loginEmail" type="email" placeholder="–ò–º–µ–π–ª" required />
          <input id="loginPass" type="password" placeholder="–ü–∞—Ä–æ–ª–∞" required />
          <button id="loginBtn" class="btn" type="submit">–í—Ö–æ–¥</button>
          <div id="loginMsg" class="msg"></div>
        </form>
      </div>

      <!-- REGISTER -->
      <div class="card">
        <h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
        <form id="regForm" class="grid">
          <input id="regName" type="text" placeholder="–ò–º–µ" required />
          <input id="regEmail" type="email" placeholder="–ò–º–µ–π–ª" required />
          <div class="row">
            <select id="regDay" required></select>
            <select id="regMonth" required></select>
            <select id="regYear" required></select>
          </div>
          <input id="regPass" type="password" placeholder="–ü–∞—Ä–æ–ª–∞" required />
          <label class="muted" style="margin-top:-4px">
            <input id="reg16" type="checkbox" /> –ü–æ—Ç–≤—ä—Ä–∂–¥–∞–≤–∞—à, —á–µ —Å–∏ –Ω–∞ 16+ –≥–æ–¥–∏–Ω–∏.
          </label>
          <button id="regBtn" class="btn" type="submit">–°—ä–∑–¥–∞–π –ø—Ä–æ—Ñ–∏–ª</button>
          <div id="regMsg" class="msg"></div>
        </form>
      </div>
    </div>

    <footer>¬© YouVibe 2025 ‚Ä¢ <span class="muted" id="apiStatus">–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ API‚Ä¶</span></footer>
  </div>

  <script>
    // === –ù–ê–°–¢–†–û–ô–ö–ê: —Å–º–µ–Ω–∏ —Ç–æ–≤–∞ –ø—Ä–∏ –Ω—É–∂–¥–∞ ===
    const API_URL = "https://backend-youvibe.onrender.com";

    // –ú–∞–ª—ä–∫ –ø–æ–º–æ—â–Ω–∏–∫ –∑–∞ fetch
    async function api(path, {method="GET", body, token} = {}){
      const r = await fetch(API_URL + path, {
        method,
        headers: {
          "Content-Type":"application/json",
          ...(token ? {Authorization: "Bearer " + token} : {})
        },
        body: body ? JSON.stringify(body) : undefined
      });
      const data = await r.json().catch(()=>({ok:false,message:"–ù–µ–≤–∞–ª–∏–¥–µ–Ω –æ—Ç–≥–æ–≤–æ—Ä"}));
      return { ok:r.ok && (data.ok !== false), status:r.status, data };
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–∞–Ω–µ –Ω–∞ –¥–∞—Ç–∞ —Å–µ–ª–µ–∫—Ç–æ—Ä–∏
    (function initDOB(){
      const dSel = document.getElementById('regDay');
      const mSel = document.getElementById('regMonth');
      const ySel = document.getElementById('regYear');
      const months = ['1','2','3','4','5','6','7','8','9','10','11','12'];
      for(let d=1; d<=31; d++){ const o=document.createElement('option'); o.value=o.textContent=String(d).padStart(2,'0'); dSel.appendChild(o); }
      months.forEach(m=>{ const o=document.createElement('option'); o.value=o.textContent=String(m).padStart(2,'0'); mSel.appendChild(o); });
      const thisYear = new Date().getFullYear();
      for(let y=thisYear; y>=1900; y--){ const o=document.createElement('option'); o.value=o.textContent=String(y); ySel.appendChild(o); }
    })();

    // Health check (footer —Å—Ç–∞—Ç—É—Å)
    (async function checkHealth(){
      try{
        const r = await fetch(API_URL + "/health");
        const ok = r.ok;
        document.getElementById('apiStatus').textContent = ok ? "API –µ –¥–æ—Å—Ç—ä–ø–Ω–æ ‚úì" : "API –Ω–µ–¥–æ—Å—Ç—ä–ø–Ω–æ";
        document.getElementById('apiStatus').className = "muted " + (ok ? "ok":"err");
      }catch{
        document.getElementById('apiStatus').textContent = "API –Ω–µ–¥–æ—Å—Ç—ä–ø–Ω–æ";
        document.getElementById('apiStatus').className = "muted err";
      }
    })();

    // LOGIN
    document.getElementById('loginForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const btn = document.getElementById('loginBtn');
      const msg = document.getElementById('loginMsg');
      msg.textContent=''; btn.disabled=true;

      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPass').value;

      try{
        const {ok, data, status} = await api("/api/auth/login", {method:"POST", body:{email, password}});
        if(ok){
          msg.textContent = '–£—Å–ø–µ—à–µ–Ω –≤—Ö–æ–¥!';
          msg.className = "msg ok";
          localStorage.setItem('token', data.token || "");
        }else{
          msg.textContent = data?.message || `–ì—Ä–µ—à–∫–∞ (${status})`;
          msg.className = "msg err";
        }
      }catch{
        msg.textContent='–ú—Ä–µ–∂–æ–≤–∞ –≥—Ä–µ—à–∫–∞.';
        msg.className = "msg err";
      }finally{ btn.disabled=false; }
    });

    // REGISTER
    document.getElementById('regForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const btn = document.getElementById('regBtn');
      const msg = document.getElementById('regMsg');
      msg.textContent=''; msg.className="msg"; btn.disabled=true;

      const name  = document.getElementById('regName').value.trim();
      const email = document.getElementById('regEmail').value.trim();
      const pass  = document.getElementById('regPass').value;
      const day   = document.getElementById('regDay').value;
      const month = document.getElementById('regMonth').value;
      const year  = document.getElementById('regYear').value;
      const ok16  = document.getElementById('reg16').checked;

      if(!ok16){
        msg.textContent='–¢—Ä—è–±–≤–∞ –¥–∞ –ø–æ—Ç–≤—ä—Ä–¥–∏—à, —á–µ —Å–∏ 16+.'; msg.className="msg warn"; btn.disabled=false; return;
      }

      try{
        const birthDate = `${year}-${month}-${day}`; // ISO —Ñ–æ—Ä–º–∞—Ç
        const payload = { name, email, password: pass, birthDate, termsAccepted: true };

        const {ok, data, status} = await api("/api/auth/register", {method:"POST", body: payload});
        if(ok){
          msg.textContent='–ü—Ä–æ—Ñ–∏–ª—ä—Ç –µ —Å—ä–∑–¥–∞–¥–µ–Ω! –ú–æ–∂–µ—à –¥–∞ –≤–ª–µ–∑–µ—à.';
          msg.className="msg ok";
        }else{
          msg.textContent = data?.message || `–ì—Ä–µ—à–∫–∞ (${status})`;
          msg.className="msg err";
        }
      }catch{
        msg.textContent='–ú—Ä–µ–∂–æ–≤–∞ –≥—Ä–µ—à–∫–∞.';
        msg.className="msg err";
      }finally{
        btn.disabled=false;
      }
    });
  </script>
</body>
</html>
